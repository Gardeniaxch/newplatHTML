<include file="public/Tphomeyy/head.html" autoordes='active' biaoti='自助下单' fdnew="{:sp_getad('滚动活动公告')}" />
<div class="zzlistcontainer">
					<div class="container">
						<div style="margin-top: 90px;">
						<div class="tab-content">
								<div role="tabpanel" class="tab-pane active" id="zzlist">
									<div class="listheader">
										<p style="font-weight: 600;">{$title}系统</p>
										<p>深度学习研究中心,第三方机构,欢迎使用我们的智能系统.</p>
									</div>

									<div class="widget widget-padding span12" style="text-align: start;">
										<div class="tasktable-header">
											<h5><span class="iconfont icon-celanliebiaogengduo1"></span> 自助列表</h5>
										</div>
										<div class="task-body" >
											<div class="row-fluid" style="margin-top: 20px;">
												<form class="form-inline sosodata" action='{:U("Tphomeyy/Index/autoordes")}' method="post">
													<div class="form-group" style="margin-bottom: 15px;">
														<select name="type"  class="form-control">
															<option value="active_link">搜索链接</option>
															<option value="active_name">搜索任务名</option>
															<option value="id">搜索任务id</option>
														</select>
													</div>
													<div class="form-group" style="margin-bottom: 15px;">
														<select name="time" class="form-control">
															<option value="all">全部</option>
															<option value="one">近一个月</option>
															<option value="three">近三个月</option>
														</select>
													</div>
													<div class="form-group" style="margin-bottom: 15px;">
														<label class="sr-only" for="listname"></label>
														<input type="text" class="form-control" id="keyword" name="keyword"  placeholder="活动名称或链接" >
													</div>
													<button type="submit" class="btn btn-default" style="color: white;margin-bottom: 15px; background-color: #4D7CFE;"><span class="glyphicon glyphicon-search" style="padding-right: 8px;"></span>查询</button>
												</form>
											</div>
											<table id="users" class="table table-striped table-bordered mydataTable" style="margin-top: 10px;">
												<thead>
													<tr role="row" class="listtableheader" style="background-color: #BB3756;color: #ffffff;font-weight: 600">
														<th class="sorting_asc" tabindex="0" rowspan="1" colspan="1" style="padding: 20px 10px;">id</th>
														<th class="sorting" tabindex="0" rowspan="1" colspan="1" style="padding: 20px 10px;">活动类型名称</th>
														<th class="sorting" tabindex="0" rowspan="1" colspan="1" style="padding: 20px 10px;">活动名称</th>
														<th class="sorting" tabindex="0" rowspan="1" colspan="1" style="padding: 20px 10px;">活动链接</th>
														<th class="sorting" tabindex="0" rowspan="1" colspan="1" style="padding: 20px 10px;">创建时间</th>
														<th class="sorting" tabindex="0" rowspan="1" colspan="1" style="padding: 20px 10px;">操作</th>
													</tr>
												</thead>
												<tbody>
												<php>$arr = array("1"=>'关注','2'=>'直投');</php>
												<foreach name='task' item="vo2">
													<tr class="even" style="background-color: rgba(245, 217, 222,0.6)">
														<td class="  sorting_1">
															<span class="tbody_header">编号:</span>
															<span>{$vo2.at_id}</span>
														</td>
														<td>
															<span class="tbody_header">活动类型名称:</span>
															<span>{$arr[$vo2['user_num']]}</span>
														</td>
														<td>
															<span class="tbody_header">活动名称:</span>
															<span style="font-weight: 600;color: #BB3756">{$vo2.task_type}</span>
														</td>
														<td>
															<span class="tbody_header">活动链接:</span>
															<a href="{$vo2.linkurl}"  target="_blank" style="color: #BB3756;">左键复制链接地址</a>
														</td>
														<td>
															<span class="tbody_header">创建时间:</span>
															<span>{$vo2.add_time}</span>
														</td>
														<td>
															<span class="tbody_header">操作:</span>
															<a class="btn btn-danger" href='{:U("Tphomeyy/Index/distask")}&at_id={$vo2.at_id}' style="background-color: #BB3756;border: 0;">下单</a>
														</td>
													</tr>
													</foreach>
												<foreach name="list" item="vo">
													<tr class="even">
														<td class="  sorting_1">
															<span class="tbody_header">编号:</span>
															<span>{$vo.id}</span>
														</td>
														<td>
															<span class="tbody_header">活动类型名称:</span>
															<span>{$vo.type_name}</span>
														</td>
														<td>
															<span class="tbody_header">活动名称:</span>
															<span>{$vo.active_name}</span>
														</td>
														<td>
															<span class="tbody_header">活动链接:</span>
															<a href="{$vo.active_link}"  target="_blank" style="color: #BB3756;">左键复制链接地址</a>
														</td>
														<td>
															<span class="tbody_header">创建时间:</span>
															<span>{$vo.found_time}</span>
														</td>
														<td>
															<span class="tbody_header">操作:</span>
															<button class="btn btn-danger" onclick="order(this,{$vo.id});" style="background-color: #4D7CFE;border: 0;">下单</button>
															<div class="zztable-content" style="display: none;">
																<form class="" style="padding: 20px;font-size: 14px;">
																	<div class="form-group">
																		<h4 class="task-name">任务名称标题：{$vo.active_name}</h4>
																	</div>
																	<div class="form-group">
																		<label for="zzable-link">链接:</label>
																		<textarea type="text" rows="3" class="form-control" id="zzable-link" disabled="disabled">{$vo.active_link}</textarea>
																	</div>
																	<div class="form-group">
																		<label for="xs-name">选手名称:</label>
																		<div class="dropdown " style="width: 100%;">
																			<div class="secondarydiv" style="display: flex; flex-direction: row;">
																				<div style="width: 100%; display: flex; flex-direction: row;justify-content: space-around;">
																					<div style="display: flex; flex: 1;">
																					<!-- <div style="display: flex; width: 80%;"> -->
																						<input type="input" name="taskPlanDay" class="form-control xs_name" style="font-size: 12px" disabled placeholder="选项将会显示在此..." />
																					</div>
																					<div class="btn btn-light select-btnla rounded-right" style="border: 1px solid #CCCCCC;background-color: #EEEEEE;" onclick="$(this).parents('.dropdown').toggleClass('show');$(this).parents('.secondarydiv').next('.dropdown-menu').toggleClass('show'); $(this).find('span').toggleClass('fa-rotate-180');">
																						<span class="glyphicon glyphicon-triangle-bottom"></span>
																					</div>
																					<button class="btn btn-outlineop" style="margin:0 3px;border: 1px solid #dddddd" type="button" onclick="removeLastItem(this);">删除</button>
																					<button class="btn btn-outlineop btn-danger" style="background-color: #DC3545" type="button" onclick="clearSelected(this);">清空</button>
																				</div>
																				
																			</div>
																			<div class="dropdown-menu" style="width: 100%; height: 400px; overflow-y: auto;">
																				<php>$AutoOrdesData = json_decode(htmlspecialchars_decode($vo['player_list']), true); foreach ($AutoOrdesData
																					as $k => $word) { echo '
																					<li style="display: flex; flex-direction: row; justify-content: space-between; cursor: pointer;padding: 8px;border-bottom: 1px solid #dddddd;" onclick="itemsSelected(this);">
																						<a href="javascript:;" style="color: #333333;font-size: 12px">'.trim($k).'</a>
																						<span class="glyphicon glyphicon-ok" style="display: none; color: #777; margin-right: 0.8rem;"></span>
																					</li>'; } </php>
																			</div>
																		</div>
																	</div>
																	<div class="form-group">
																		<label for="fabu-num">发布数量:</label>
																		<input type="text" class="form-control" id="fabu-num" value="0" name="num"  placeholder="发布的数量，不能小于100">
																	</div>
																	<div class="form-group">
																		<label for="zzxs-num">限速每分钟:</label>
																		<input type="number" class="form-control" id="zzxs-num" name="xzno" value="0" placeholder="">
																	</div>
																	<div class="form-group">
																		<label for="jianjie">简介:</label>
																		<textarea class="form-control" name="jianjie" rows="3"></textarea>
																	</div>
																	<div class="form-group">
																		<label for="beizhu">备注:</label>
																		<textarea class="form-control" name="beizhu" rows="3"></textarea>
																	</div>
																</form>
																</div>
														</td>
													</tr>
													</foreach>
												</tbody>
											</table>
											<div class="page-group mypage">
													{$page}
												</div>
										</div>
									</div>

								</div>
							</div>

						</div>

					</div>
				</div>
<include file="public/Tphomeyy/foot.html" />
<script>
function getsoso() {
    var data = $("#keyword").val();
    var type = $('.sosodata').serialize()+'&keyword='+data;
    window.location.href = '{:U("Tphomeyy/Index/autoordes")}&'+type;

}

function removeLastItem(that) {
	var input = $(that).parent()
		.find("[name='taskPlanDay']");
	// 没有项目
	if (input.val() == "") return;
	var text = /,?([^,]+)$/.exec(input.val())[1];
	if (!text) return;
	input.val(input.val()
		.toString()
		.replace(/,?[^,]+$/, "")
		.replace(/^,/, ""));
	$(that).parents(".dropdown")
		.find(".dropdown-menu > li").each(function (i, e) {
			if ($(e).find("a").text() == text) {
				$(e).attr("selected", false)
					.find("span")
					.hide();
			}
		});
}
function clearSelected(that) {
	$(that).parents(".dropdown")
		.find(".dropdown-menu > li")
		.attr("selected", false)
		.find("span")
		.hide();
	$(that).parent()
		.find("[name='taskPlanDay']")
		.val("");
}
// 选中了下单中选项列表中的一项
function itemsSelected(that) {
	// 如果没有被选中
	if (!$(that).attr("selected")) {
		// 设置选中
		$(that).attr("selected", true);
		// 显示图标
		$(that).find("span").show();
		// 添加值到 input
		var input = $(that).parents('.dropdown').find('[name=\'taskPlanDay\']');
		// window.inputOfMe = input;
		input.val(input.val() != "" ?
			(input.val() + "," + $(that).find("a").text()) :
			$(that).find("a").text());
		// window.textOfMe = $(that);

	}
	// 如果被选中
	else {
		// 做与上相反的事情
		$(that).attr("selected", false);
		$(that).find("span").hide();
		var input = $(that).parents('.dropdown').find('[name=\'taskPlanDay\']');
		// var reg = 
		input.val(input.val()
			.toString()
			.replace($(that).find("a").text(), "")
			.replace(/^,/, "")
			.replace(/,$/, ""));

	}
}

function order(el,id) {
	var fbwidth, fbheight;
	if($("html").width() <= 600) {
		fbwidth = '100%';
		fbheight = '100%';
	} else {
		fbwidth = '600px';
		fbheight = '560px';
	}
	layer.open({
		type: 1,
		title: "下单",
		btn: ['确定', '取消'],
		btn1: function (index, layero) {
			var xs_name = $.trim($(layero).find(".xs_name").val());
			var data = $(layero).find("form").serialize() + '&taskPlanDay=' + xs_name;
			var indexx = layer.load(1, {
                shade: [0.1,'#fff'] //0.1透明度的白色背景
            });  
			$.post('{:U("Tphomeyy/server/addtaskhelp")}&id='+id, data, function (data) {
				layer.msg(data.msg);
				layer.close(indexx);
				if (data.status == 1) {
					layer.close(index)
					setTimeout(function () {
						window.location.href = '{:U("Tphomeyy/Index/mywork")}'
					}, 1000);
				}
			}, 'json');
		},
		area: [fbwidth, fbheight],
		content: $(el).next(".zztable-content").html()
	}, function() {
		layer.msg('下单成功', {
			icon: 1
		});
	}, function() {
		layer.closeAll();
	});
}
</script>
</body>
</head>